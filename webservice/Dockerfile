# JDK 17 ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¤ì • (.idea/misc.xml ì°¸ê³ )
FROM maven:3.9-eclipse-temurin-17-focal AS builder

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# Maven ê´€ë ¨ íŒŒì¼ ë³µì‚¬
COPY ./pom.xml ./pom.xml
COPY ./.mvn ./.mvn
COPY ./mvnw .
COPY ./mvnw.cmd .

# --- ğŸ‘‡ [í•µì‹¬ ìˆ˜ì •] ---
# Linux ë¹Œë“œ í™˜ê²½ì—ì„œ mvnw íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
RUN chmod +x ./mvnw
# --- [ìˆ˜ì • ì™„ë£Œ] ---

# ì˜ì¡´ì„± ë‹¤ìš´ë¡œë“œ (ì†ŒìŠ¤ì½”ë“œ ë³€ê²½ê³¼ ë³„ë„ë¡œ ìºì‹±í•˜ê¸° ìœ„í•¨)
RUN ./mvnw dependency:go-offline -B

# ì†ŒìŠ¤ì½”ë“œ ë³µì‚¬
COPY ./src ./src

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ (í…ŒìŠ¤íŠ¸ëŠ” ìƒëµ)
RUN ./mvnw package -DskipTests

# --- ì‹¤í–‰ ë‹¨ê³„ ---
FROM eclipse-temurin:17-jre-focal

WORKDIR /app

# ë¹Œë“œëœ JAR íŒŒì¼ ë³µì‚¬
COPY --from=builder /app/target/*.jar app.jar

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8080

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
ENTRYPOINT ["java", "-jar", "app.jar"]